<html>
<head>
 <title>linkpad 0.1</title>
  <style>
    #noteList {
      width: 500px; 
    }
    .note {
      float: left;
      background-color: #DDD;
      width: 480px;
    }
    .note .title {
      font-weight: bold;
      width: 100%;
    }
    .note .tags {
      width: 100%;
    }
  </style>
  
  <script type="text/javascript">
    // Test
    // ...
    // ...

  
    function addNote(text) {
      let nid = incrNextId();
      let jsn = {'id': nid, 'text': text, 'tags': "", 'loc': {}};
      noteToDom(jsn);
    }
    
    function noteToDom(jsn) {
      let div = document.createElement('div');
      div.className = 'note';
      div.innerHTML = "<div id=\"" + jsn.id + "\" class=\"title\" label=\"" + jsn.id + "\"  contenteditable=\"true\">" + jsn.text + "</div><div class\"tags\" contenteditable=\"true\">" + jsn.tags + "</div>";
      document.getElementById("noteList").appendChild(div); 
    }
    // event listener for keyup
    function checkTabPress(e) {
        "use strict";
        // pick passed event or global event object if passed one is empty
        e = e || event;
        var activeElement;
        if (e.keyCode == 9) {
            // Here read the active selected link.
            addNote('new text tab');
        }
    }
    
    function incrNextId() {
      let nid = localStorage.getItem('lastId');
      if(!nid)
        nid = 0;
      
      nid = parseInt(nid) + 1;
      localStorage.setItem('lastId', "" + nid);
      
      return nid;
    }
    
    function saveNote(jsn) {
    	localStorage.setItem(jsn.id, JSON.stringify(jsn));
    }
    
    function loadAllNotes() {
      let lid = parseInt(localStorage.getItem('lastId'));
      if(!lid) lid = 0;
      
      for(i = 0; i < lid; i++) {
        loadNote(i);
      }
    }
    
    function loadNote(id) {
      let n = localStorage.getItem(id);
      if(n) {
        n = JSON.parse(n);
        noteToDom(n);
      }
    }
    

  </script>
</head>

<body>
  <div id="tagList">&nbsp;</div>
  <div id="noteList">&nbsp;
  </div>
  <a href="javascript:void(addNote('new note'))">Add note</a>
  
  <script type="text/javascript">
    loadAllNotes();

	window.addEventListener('keyup', checkTabPress);
    window.addEventListener('paste', (event) => {
      let text = (event.clipboardData || window.clipboardData).getData('text');
      addNote(text);
    });
    /*const selectElement = document.querySelector('.note');
    selectElement.addEventListener('change', (event) => {
     // const result = document.querySelector('.result');
      //result.textContent = `You like ${event.target.value}`;
      console.log("shit be changed yall");
    });*/
  </script>
</body>
</html>
