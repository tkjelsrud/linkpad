<html>
<head>
 <title>linkpad 0.1</title>
  <style>
    /*
      HEX: #d5f4e6
      HEX: #80ced6
      HEX: #fefbd8
      HEX: #618685
    */
    
    #noteList {
      width: 500px; 
    }
    .note {
      float: left;
      background-color: #DDD;
      width: 480px;
      margin: 4px;
      filter: drop-shadow(2px 2px 3px black);
      border: 1px solid #DDD;
    }
    .note .title {
      font-weight: bold;
      width: 100%;
    }
    .note .tags {
      width: 100%;
    }

    .note .tags::before {
      content: '#';
	}
  </style>
  
  <script type="text/javascript">
  
    function addNote(text) {
      let nid = incrNextId();
      let jsn = {'id': nid, 'text': text, 'tags': "", 'loc': {}};
      noteToDom(jsn);
    }
    
    function noteToDom(jsn) {
      let div = document.createElement('div');
      div.id = jsn.id;
      div.className = 'note';
      div.innerHTML = "<div class=\"title\" label=\"" + jsn.id + "\"  contenteditable=\"true\" onblur=\"saveDomNote(" + jsn.id + ")\">" + jsn.text + "</div><div class\"tags\" contenteditable=\"true\" onblur=\"saveDomNote(" + jsn.id + ")\">" + jsn.tags + "</div>";
      document.getElementById("noteList").appendChild(div); 
    }
    
    function checkTabPress(e) {
        "use strict";
        // pick passed event or global event object if passed one is empty
        e = e || event;
        var activeElement;
        if (e.keyCode == 9) {
            // Here read the active selected link.
            addNote('new text tab');
        }
    }
    
    function incrNextId() {
      let nid = localStorage.getItem('lastId');
      if(!nid)
        nid = 0;
      
      nid = parseInt(nid) + 1;
      localStorage.setItem('lastId', "" + nid);
      
      return nid;
    }
    
    function saveDomNote(id) {
      let jsn = {'id': id};
   	  let d = document.getElementById(id);
      jsn.text = d.children[0].innerText;
      jsn.tags = d.children[1].innerText;
      saveNote(jsn);
    }
    
    function saveNote(jsn) {
    	localStorage.setItem(jsn.id, JSON.stringify(jsn));
    }
    
    function loadAllNotes() {
      let lid = parseInt(localStorage.getItem('lastId'));
      if(!lid) lid = 0;
      
      for(i = 0; i < lid; i++) {
        loadNote(i);
      }
    }
    
    function loadNote(id) {
      let n = localStorage.getItem(id);
      if(n) {
        n = JSON.parse(n);
        noteToDom(n);
      }
    }

  </script>
</head>

<body>
  <div id="tagList">&nbsp;</div>
  <div id="noteList">&nbsp;
  </div>
  <a href="javascript:void(addNote('new note'))">Add note</a>
  
  <script type="text/javascript">
    loadAllNotes();

	window.addEventListener('keyup', checkTabPress);
    window.addEventListener('paste', (event) => {
      let text = (event.clipboardData || window.clipboardData).getData('text');
      addNote(text);
    });
  </script>
</body>
</html>
